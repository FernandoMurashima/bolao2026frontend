<div class="top-home-btn">
  <a routerLink="/home" class="btn-home">Home </a>
</div>

<div class="bets-page">
  <div class="tabs">
    <button
      *ngFor="let s of stages"
      type="button"
      [class.active]="activeStageOrder === s.order"
      (click)="setActiveStage(s.order)"
    >
      {{ s.name }}
    </button>

    <!-- link nova tela de especiais -->
    <button
      type="button"
      class="extras-tab"
      routerLink="/palpites-especiais"
    >
      Palpites especiais
    </button>
  </div>

  <div class="content">
    <div class="section">
      <h3>Palpites por jogo</h3>
      <div class="stage-info" *ngIf="stages.length">
        <span>
          Fase: {{ getStageByOrder(activeStageOrder)?.name }}
        </span>
        <span>
          Pontos: Placar exato
          {{ getStageByOrder(activeStageOrder)?.points_exact_score }} |
          Resultado
          {{ getStageByOrder(activeStageOrder)?.points_result }} |
          Gols de um time
          {{ getStageByOrder(activeStageOrder)?.points_one_team_goals }}
        </span>
        <span>
          Limite:
          {{ getStageByOrder(activeStageOrder)?.deadline | date: 'short' }}
        </span>
      </div>

      <div class="alert error" *ngIf="stageError">
        {{ stageError }}
      </div>

      <div *ngIf="loadingMatches">Carregando jogos...</div>

      <div *ngIf="!loadingMatches">
        <table class="matches-table" *ngIf="getCurrentStageRows().length">
          <thead>
            <tr>
              <th>Grupo</th>
              <th>Data/Hora</th>
              <th>Casa</th>
              <th>Palpite</th>
              <th>Fora</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of getCurrentStageRows()">
              <td>{{ row.match.group_name }}</td>
              <td>{{ row.match.kickoff | date: 'short' }}</td>
              <td>{{ row.match.home_team.code }}</td>
              <td class="score-inputs">
                <input
                  type="number"
                  min="0"
                  [disabled]="isStageDeadlinePassed(activeStageOrder)"
                  [value]="row.home_score"
                  (input)="updateScore(row, 'home_score', $any($event.target).value)"
                />
                <span>x</span>
                <input
                  type="number"
                  min="0"
                  [disabled]="isStageDeadlinePassed(activeStageOrder)"
                  [value]="row.away_score"
                  (input)="updateScore(row, 'away_score', $any($event.target).value)"
                />
              </td>
              <td>{{ row.match.away_team.code }}</td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="!getCurrentStageRows().length">
          Nenhum jogo encontrado para esta fase.
        </div>

        <div class="actions">
          <button
            type="button"
            (click)="saveStageBets()"
            [disabled]="savingStage || isStageDeadlinePassed(activeStageOrder)"
          >
            {{ savingStage ? 'Salvando...' : 'Salvar palpites da fase' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

